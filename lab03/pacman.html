<html>
<head>
    <title>Pacman</title>
</head>

<body >
    <h1>Pacman</h1>
    <p>Your current level is: <span id="currentLevel">1</span></p>
    <button onclick="createGame(10)" class="button">Start Game</button>
    <div id="gameDisplay"> </div>
    <div class="buttons">
        <button onclick="moveLeft(game)" class="button">Move Left</button>
        <button onclick="moveRight(game)" class="button">Move Right</button>
    </div>
</body>
</html>
    
<script>
var pacman = "C", ghost = "^", fruit = "@", pellet = ".";
var posPacman = 0, posFruit = 0, posGhost = 0;
var size = 0, game, score, level = 1;
const gameDisplay = document.getElementById('gameDisplay');
const levelDisplay = document.getElementById("currentLevel");

function createGame(n){
    size = n;

    // Initialize Game
    game = new Array(n-1).fill(pellet);

    posPacman = getRandomNumber(1, n)
    game[posPacman] = pacman;

    do {
        posFruit = getRandomNumber(1, n);
    } while (posFruit == posPacman);
    game[posFruit] = fruit;

    do {
        posGhost = getRandomNumber(1, n);
    } while (posGhost == posPacman);
    game[posGhost] = ghost + game[posGhost];
    
    // Print game
    console.log(game);
    displayGame(game);
}

function move(game, currentPos, nextPos, chr){
    if(game[currentPos].length == 1){
        game[currentPos] = "";
    }else{
        game[currentPos] = game[currentPos].slice(1)
    }
    process(game, nextPos);
    if(chr == pacman){
        game[nextPos] = pacman;
        posPacman = nextPos;
    }else if(chr == ghost){
        game[nextPos] = ghost + game[nextPos];
        posGhost = nextPos;
    }
    currentPos = nextPos;
}

function moveLeft(game){
    var nextPos = findNextPosition("left", posPacman)
    move(game, posPacman, nextPos, pacman)

    console.log(game);
    displayGame(game);
}

function moveRight(game){
    var nextPos = findNextPosition("right", posPacman)
    move(game, posPacman, nextPos, pacman)

    console.log(game);
    displayGame(game);
}

function process(game, a){ // process pacman eating pellet, if pacman lands on pellet
    if(game[a] == pellet){
        score += 10;
    }else if(game[a] == fruit){
        score += 100;
    }else if(game[a[0]] == ghost){
    }

    // Completion of level
    if(countItem(game, pellet) == 0){
        console.log("Completion of Level " + level);
        level += 1;
        levelDisplay.textContent = level;
        console.log("Advance to Level " + level);
        game = null;
        createGame(size + 5);
        displayGame(game);
    }
}

var interval = window.setInterval(moveGhost, 2000);

function moveGhost(){
    var nextPos = 0;
    getRandomNumber(0, 1) ? nextPos = findNextPosition("left", posGhost): nextPos = findNextPosition("right", posGhost);
    move(game, posGhost, nextPos, ghost)

    // console.log(game);
    displayGame(game);
}

function displayGame(game){
    gameDisplay.textContent = JSON.stringify(game);
}

function findNextPosition(direction, position){
    newPosition = 0;
    if(direction == "left"){ // Move left
        position == 0 ? newPosition = size - 1: newPosition = position - 1
    }else{ // Move right
        position == size - 1 ? newPosition = 0: newPosition = position + 1
    }
    return newPosition;
}

function countItem(game, item){
    var count = 0;
    for (let i = 0; i < game.length; i++) {
        if (game[i] === item) {
            count += 1;
        }
    }
    return count;
}

function getRandomNumber(low, high){ // inclusive of low and high bounds
    return Math.floor(low + Math.random() * high);
}
</script>
